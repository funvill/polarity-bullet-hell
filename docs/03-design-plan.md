# ðŸŽ¯ Development Plan

## Overview

This document outlines the phased development approach for the polarity-based bullet hell game using three.js. The plan prioritizes getting core mechanics working early, then incrementally adding features to build toward the full experience.

---

## Phase 0: Project Setup & Foundation âœ… COMPLETE

**Goal:** Establish the technical foundation and development environment.

### Tasks

1. **Initialize Project Structure** âœ…
   - Create project directory structure:
     ```
     bullet-hell/
     â”œâ”€â”€ docs/
     â”œâ”€â”€ src/
     â”‚   â”œâ”€â”€ core/
     â”‚   â”œâ”€â”€ entities/
     â”‚   â”œâ”€â”€ systems/
     â”‚   â”œâ”€â”€ ui/
     â”‚   â””â”€â”€ main.js
     â”œâ”€â”€ assets/
     â”‚   â”œâ”€â”€ audio/
     â”‚   â””â”€â”€ textures/
     â”œâ”€â”€ index.html
     â””â”€â”€ package.json
     ```
   - Initialize npm project âœ…
   - Install three.js dependency âœ…

2. **Basic Three.js Scene Setup** âœ…
   - Create HTML canvas element âœ…
   - Initialize three.js renderer (WebGL) âœ…
   - Set up orthographic camera for top-down view âœ…
   - Configure scene with black background âœ…
   - Implement basic render loop (60 FPS target) âœ…
   - Add window resize handling âœ…

3. **Development Tools** âœ…
   - Set up local development server (Vite) âœ…
   - Configure hot-reload for rapid iteration âœ…
   - Add basic stats/FPS counter for performance monitoring âœ…

**Deliverable:** A running three.js scene with a render loop displaying an empty play area. âœ…

**Estimated Time:** 1-2 days

---

## Phase 1: MVP - Core Polarity Mechanic âœ… COMPLETE

**Goal:** Implement the absolute minimum playable prototype with polarity switching, player ship, enemies, and bullets.

### 1.1 Player Ship âœ…

**Tasks:**
- Create player ship entity as simple geometric shape (white triangle/circle) âœ…
- Implement 8-directional movement (5.0 units/sec) âœ…
- Add keyboard input handling (arrow keys or WASD) âœ…
- Constrain movement to play area boundaries âœ…
- Implement 4px circular hitbox visualization (debug mode) âœ…
- Display ship in current polarity color (black or white) âœ…

**Technical Details:**
- Use `THREE.Mesh` with `THREE.CircleGeometry` or custom shape
- Position update at 60 Hz
- Boundary checking: `x: [playArea.left, playArea.right]`, `y: [playArea.bottom, playArea.top]`

### 1.2 Polarity System âœ…

**Tasks:**
- Implement polarity state enum: `{BLACK, WHITE}` âœ…
- Add polarity switch input (Right Mouse Button) âœ…
- Create visual feedback for polarity switch: âœ…
  - Ship color change (instant) âœ…
  - 200ms color inversion effect âœ…
  - Simple sound effect (Web Audio API) âœ…
- Update ship rendering based on current polarity âœ…

**Technical Details:**
```javascript
class Player {
  polarity: 'BLACK' | 'WHITE'
  switchPolarity() {
    this.polarity = this.polarity === 'BLACK' ? 'WHITE' : 'BLACK'
    // Trigger visual/audio feedback
  }
}
```

### 1.3 Player Bullets âœ…

**Tasks:**
- Implement continuous fire (Left Mouse held = 5 shots/sec) âœ…
- Create bullet entity (small circle/rectangle) âœ…
- Bullets inherit player's current polarity color âœ…
- Bullets travel toward mouse direction at constant velocity âœ…
- Remove bullets when off-screen âœ…
- Bullet pooling for performance âœ…

**Technical Details:**
- Fire rate: 0.1s interval between shots
- Bullet speed: 8 units/sec upward
- Use object pooling to avoid constant allocation/deallocation

### 1.4 Basic Enemies âœ…

**Tasks:**
- Create simple enemy type (E1 - White Drone) âœ…
  - Fixed polarity: WHITE âœ…
  - HP: 1 âœ…
  - Simple geometric shape (hexagon) âœ…
  - Spawns at top of screen âœ…
  - Moves downward slowly (50 units/sec base) âœ…
- Create second enemy type (E2 - Black Drone) âœ…
  - Fixed polarity: BLACK âœ…
  - Otherwise identical to E1 âœ…
- Implement basic spawn system (automated wave spawning) âœ…

**Technical Details:**
- Enemy rendered as `THREE.Mesh` with polarity-colored material
- Remove enemies when off-screen (bottom)
- Track enemy polarity property

### 1.5 Enemy Bullets âœ…

**Tasks:**
- Enemies emit bullets periodically âœ…
- Bullet color matches enemy polarity âœ…
- Bullets travel downward toward player âœ…
- Simple straight-line trajectory (no complex patterns yet) âœ…

**Technical Details:**
- Emission rate: 1 bullet per second per enemy
- Bullet speed: 3 units/sec downward
- Bullets as small circles with polarity color

### 1.6 Collision Detection âœ…

**Tasks:**
- Implement bullet-to-enemy collision: âœ…
  - Check player bullets against enemies âœ…
  - Deal damage on hit âœ…
  - Opposite polarity = 2x damage (1-shot kill for HP:1 enemies) âœ…
  - Same polarity = bullets pass through (no damage) âœ…
  - Destroy bullet and apply damage âœ…
- Implement bullet-to-player collision: âœ…
  - Check enemy bullets against player hitbox (4px core + shield radius) âœ…
  - **Opposite polarity bullet = damage** âœ…
  - **Same polarity bullet = absorption (no damage)** âœ…
  - For MVP: simple life counter (start with 3 lives) âœ…

**Technical Details:**
- Use circular bounding box collision
- Distance check: `dist(bullet.pos, target.pos) < (bullet.radius + target.radius)`
- Collision check every frame (60 Hz)

### 1.7 Absorption Mechanic (Simplified) âœ…

**Tasks:**
- When same-polarity bullet hits player: âœ…
  - Remove bullet from scene âœ…
  - Visual feedback (particle effect) âœ…
  - Increment basic energy counter (display as text) âœ…
  - Cap energy at 100 âœ…

**Technical Details:**
```javascript
onBulletAbsorbed(color) {
  if (color === player.polarity) {
    energy = Math.min(energy + 2, 100)
    // Remove bullet, show feedback
  }
}
```

### 1.8 Basic UI/HUD âœ…

**Tasks:**
- Display polarity indicator (text: "WHITE" or "BLACK") âœ…
- Show energy meter with progress bar âœ…
- Display lives remaining (text + visual rings on ship) âœ…
- Simple score counter (text: "Score: 0") âœ…

**Technical Details:**
- Use HTML overlay for MVP (not three.js text)
- Position: top-left corner
- Update every frame via DOM manipulation

### 1.9 Game Loop & State âœ…

**Tasks:**
- Implement basic game states: START_SCREEN, PLAYING, GAME_OVER âœ…
- Game over when lives = 0 âœ…
- Display "GAME OVER" message âœ…
- Restart option (R key) âœ…

**MVP Success Criteria:**
- âœ… Player can move ship around screen
- âœ… Player can switch polarity (Right Mouse Button)
- âœ… Player can fire bullets (Left Mouse Button)
- âœ… Enemies spawn and move
- âœ… Enemies fire bullets
- âœ… Opposite-polarity bullets damage player
- âœ… Same-polarity bullets are absorbed (no damage + energy gain)
- âœ… Player bullets destroy enemies
- âœ… Basic UI shows polarity, energy, lives
- âœ… Game over on death

**Deliverable:** A playable prototype demonstrating the core polarity mechanic. âœ…

**Estimated Time:** 5-7 days

---

## Phase 2: Enhanced Combat & Feedback âœ… COMPLETE

**Goal:** Make the game feel good to play with polish, visual effects, and better combat flow.

### 2.1 Visual Effects âœ…

**Tasks:**
- Enemy death explosion effect (particles) âœ…
- Bullet absorption visual effect (particle burst on player) âœ…
- Polarity switch screen flash/wash effect âœ…
- Bullet trail effects âœ…
- Ship polarity aura/glow (shield ring) âœ…

### 2.2 Special Weapon (Polarity Bomb) âœ…

**Tasks:**
- Implement special weapon trigger (Space key) âœ…
- When energy = 100, allow special activation âœ…
- Effect: Convert all on-screen bullets to player's polarity (instant absorption) âœ…
- Visual: Screen-wide pulse effect âœ…
- Audio: Distinct activation sound âœ…
- Reset energy to 0 after use âœ…

### 2.3 Audio System âœ…

**Tasks:**
- Add sound effects: âœ…
  - Bullet fire âœ…
  - Enemy hit (visual flash) âœ…
  - Enemy destroyed âœ…
  - Bullet absorbed âœ…
  - Polarity switch âœ…
  - Special weapon activation âœ…
  - Player damage âœ…
- Implement basic chiptune background music loop (procedural) âœ…
- Dynamic music intensity based on bullet count âœ…

### 2.4 Chain Combo System âœ…

**Tasks:**
- Track last 3 enemy kills by color âœ…
- Detect 3 consecutive same-color kills âœ…
- Increment chain counter âœ…
- Display chain multiplier in HUD âœ…
- Apply multiplier to score: (chainCount + 1)Â² âœ…
- Visual/audio feedback on chain increase âœ…
- Reset chain on color mismatch âœ…

**Technical Details:**
```javascript
chainQueue = [] // FIFO queue, max length 3
scoringFormula = baseScore * (chainCount ^ 2)
```

### 2.5 Improved Enemy Patterns âœ…

**Tasks:**
- Add formation spawning (multiple spawn patterns) âœ…
- Implement wave system (endless waves) âœ…
- Add enemy movement patterns (sine wave, circular, zigzag, converge) âœ…
- Enemies fire straight bullets (boss has patterns) âœ…

**Deliverable:** A polished combat experience with satisfying feedback and the chain combo system. âœ…

**Estimated Time:** 5-7 days

---

## Phase 3: Enemy Variety & Patterns âœ… MOSTLY COMPLETE

**Goal:** Add depth through enemy types and bullet patterns.

### 3.1 Advanced Enemy Types âœ…

**Tasks:**
- Implement Special Enemy Types: âœ…
  - Sniper (slow, accurate, long-range) âœ…
  - Sprayer (multi-bullet spread) âœ…
  - Kamikaze (fast, rams player) âœ…
  - Tank (high HP, slow) âœ…
  - Dodger (evades bullets) âœ…
- Add enemy size variations (small, medium, large) âœ…
- Implement enemy AI behaviors âœ…

### 3.2 Bullet Pattern System âœ…

**Tasks:**
- Create pattern library: âœ…
  - Radial burst (8-16 bullets in circle) âœ…
  - Spiral wave âœ…
  - Aimed shots (toward player position) âœ…
  - Ring patterns âœ…
- Boss patterns implemented âœ…
- Deterministic spawning (wave-based) âœ…

### 3.3 Mini-Boss âœ…

**Tasks:**
- Create Boss entity class âœ…
- HP: 50+ (scales with level) âœ…
- 3 distinct phases âœ…
- Unique bullet patterns for each phase âœ…
- Polarity switches at phase transition âœ…
- Victory celebration effect (debris spawning) âœ…
- Boss appears every 10 waves âœ…

**Deliverable:** Variety in enemies and challenging bullet patterns. âœ…

**Estimated Time:** 5-7 days

---

## Phase 4: Progression & World Structure âœ… MOSTLY COMPLETE

**Goal:** Build the endless survival mode with progressive difficulty.

### 4.1 Endless Mode Structure âœ…

**Tasks:**
- Implement continuous spawning âœ…
- Progressive difficulty scaling: âœ…
  - Enemy speed increases âœ…
  - Bullet speed increases âœ…
  - Fire rate increases âœ…
  - Spawn rate increases âœ…
- Difficulty curve formula based on score âœ…
- Wave-based spawning system âœ…

### 4.2 Power-Up System âœ…

**Tasks:**
- Implement power-up drops from enemies (15% chance) âœ…
- Power-up types: âœ…
  - Shield (extra life) âœ…
  - Increased fire rate âœ…
  - Energy boost âœ…
  - Score multiplier âœ…
- Power-up duration timers âœ…
- Visual indicators for power-ups âœ…

### 4.3 Roguelike Reset System âœ…

**Tasks:**
- Implement death â†’ full reset âœ…
- Display stats on death screen: âœ…
  - Final score âœ…
  - Max chain âœ…
- Quick restart option (R key) âœ…
- âš ï¸ High score persistence (localStorage) - NOT IMPLEMENTED

**Deliverable:** Full endless survival mode with progression. âœ…

**Estimated Time:** 4-6 days

---

## Phase 5: Boss Encounters âœ… COMPLETE

**Goal:** Implement memorable boss fights with phase-based mechanics.

### 5.1 Boss Framework âœ…

**Tasks:**
- Create boss entity system âœ…
- HP bar display (on boss) âœ…
- Phase transition system âœ…
- Boss warning indicator (telegraph effect) âœ…
- Music mode changes to 'boss' âœ…

### 5.2 First Boss Implementation âœ…

**Tasks:**
- HP: 50+ (scales with boss level) âœ…
- 3 phases: âœ…
  - Phase 1: Spiral + Burst patterns âœ…
  - Phase 2: Added Aimed pattern (66% HP) âœ…
  - Phase 3: All patterns including Wave & Ring (33% HP) âœ…
- Phase transition effects âœ…
- Victory sequence (debris spawning) âœ…
- Polarity switches between phases âœ…

### 5.3 Additional Bosses âš ï¸

**Tasks:**
- âš ï¸ Design and implement 2 more boss encounters - NOT IMPLEMENTED
- Boss scaling with difficulty level âœ…
- Bosses appear every 10 waves âœ…

**Deliverable:** Epic boss battles with phase-based mechanics. âœ…

**Estimated Time:** 6-8 days

---

## Phase 6: Polish & Juice âœ… MOSTLY COMPLETE

**Goal:** Make the game feel amazing through visual polish and game feel.

### 6.1 Advanced Visual Effects âœ…

**Tasks:**
- Screen shake on impacts âœ…
- Polarity switch flash effect âœ…
- Energy meter with glow/pulse when full âœ…
- Screen-edge glow for special weapon âœ…
- Bullet visual improvements (glow, trails) âœ…
- Muzzle flash on shooting âœ…
- Camera kick on firing âœ…

### 6.2 Enhanced UI/HUD âœ…

**Tasks:**
- Move HUD elements to top/bottom edges âœ…
- Polarity indicator with styled display âœ…
- Animated chain counter with pulse effect âœ…
- Lives display (visual rings on ship) âœ…
- Score with proper formatting (8 digits) âœ…
- Energy bar with polarity-colored gradient âœ…
- FPS and entity count display âœ…

### 6.3 Animation & Feel âœ…

**Tasks:**
- Ship polarity switch animation (ring effect) âœ…
- Enemy spawn patterns âœ…
- Power-up collect animation âœ…
- Smooth camera shake/kick âœ…
- Life rings on player ship âœ…

### 6.4 Audio Mastering âœ…

**Tasks:**
- Balance all sound effect volumes âœ…
- Create procedural chiptune music âœ…
- Music intensity based on bullet count âœ…
- Music mode transitions (normal/danger/boss) âœ…
- Boss warning sound âœ…

**Deliverable:** A highly polished, satisfying game experience. âœ…

**Estimated Time:** 5-7 days

---

## Phase 7: Accessibility & Tutorial âš ï¸ PARTIAL

**Goal:** Make the game accessible and teach players the mechanics.

### 7.1 Tutorial Level âš ï¸

**Tasks:**
- Create guided first experience âš ï¸ START SCREEN WITH INSTRUCTIONS âœ…
- On-screen prompts for each mechanic âš ï¸ CONTROLS HELP PANEL âœ…
- âš ï¸ Interactive tutorial - NOT IMPLEMENTED
- âš ï¸ Simplified first wave - NOT IMPLEMENTED

### 7.2 Accessibility Features âš ï¸

**Tasks:**
- âš ï¸ Colorblind mode - NOT IMPLEMENTED
- âš ï¸ High contrast mode - NOT IMPLEMENTED
- âš ï¸ Minimal UI mode - NOT IMPLEMENTED

### 7.3 Performance Optimization âœ…

**Tasks:**
- Object pooling for bullets âœ…
- Entity removal when off-screen âœ…
- Efficient collision detection âœ…
- Target: stable 60 FPS on mid-range hardware âœ…
- FPS monitoring âœ…

**Deliverable:** An accessible game that teaches new players effectively. âš ï¸

**Estimated Time:** 4-5 days

---

## Phase 8: Final Testing & Release âš ï¸ IN PROGRESS

**Goal:** Bug fixes, balance, and deployment.

### 8.1 Playtesting & Balance âœ…

**Tasks:**
- Internal playtesting sessions âœ…
- Difficulty curve adjustment âœ…
- Score balance tuning âœ…
- Enemy spawn rate balancing âœ…
- Control responsiveness âœ…

### 8.2 Bug Fixes & Optimization âœ…

**Tasks:**
- Fix critical bugs âœ…
  - Boss debris size fixed âœ…
  - Bullet collision logic fixed âœ…
  - Camera shake decay implemented âœ…
- Performance optimization âœ…
- âš ï¸ Cross-browser testing - PARTIAL
- âš ï¸ Mobile browser testing - NOT TESTED

### 8.3 Deployment âš ï¸

**Tasks:**
- Vite build system configured âœ…
- âš ï¸ Hosting setup - NOT DEPLOYED
- âš ï¸ Meta tags - NOT ADDED
- README with credits âœ…
- âš ï¸ Landing page - BASIC INDEX.HTML ONLY

### 8.4 Post-Release âš ï¸

**Tasks:**
- âš ï¸ All post-release tasks pending deployment

**Deliverable:** A published, playable web game. âš ï¸

**Estimated Time:** 3-4 days

---

## Technical Architecture Notes

### Core Systems

1. **Game Loop**
   - Fixed timestep update (60 Hz)
   - Variable render loop
   - Delta time accumulator for consistent physics

2. **Entity Component System (Simple)**
   - Entities: Player, Enemy, Bullet, PowerUp, Boss
   - Components: Position, Velocity, Collider, Health, Polarity
   - Systems: Movement, Collision, Rendering, Input

3. **Performance Targets**
   - 60 FPS minimum
   - < 100ms input latency
   - Support 200+ bullets on screen simultaneously
   - Fast startup time (< 3 seconds)

### File Structure

```
src/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ Game.js           # Main game loop
â”‚   â”œâ”€â”€ Scene.js          # Three.js scene manager
â”‚   â”œâ”€â”€ Input.js          # Keyboard input handling
â”‚   â””â”€â”€ Audio.js          # Sound manager
â”œâ”€â”€ entities/
â”‚   â”œâ”€â”€ Player.js         # Player ship
â”‚   â”œâ”€â”€ Enemy.js          # Enemy base class
â”‚   â”œâ”€â”€ Bullet.js         # Bullet entity
â”‚   â”œâ”€â”€ Boss.js           # Boss entity
â”‚   â””â”€â”€ PowerUp.js        # Power-up entity
â”œâ”€â”€ systems/
â”‚   â”œâ”€â”€ CollisionSystem.js
â”‚   â”œâ”€â”€ SpawnSystem.js
â”‚   â”œâ”€â”€ ScoringSystem.js
â”‚   â”œâ”€â”€ ChainSystem.js
â”‚   â””â”€â”€ PolilitySystem.js
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ HUD.js            # Main HUD
â”‚   â”œâ”€â”€ Menu.js           # Game over/pause screens
â”‚   â””â”€â”€ Tutorial.js       # Tutorial overlays
â”œâ”€â”€ patterns/
â”‚   â””â”€â”€ BulletPatterns.js # Pattern library
â””â”€â”€ main.js               # Entry point
```

---

## Risk Mitigation

### Technical Risks

1. **Performance with Many Bullets**
   - Mitigation: Object pooling, frustum culling, canvas rendering limits
   - Test early with 300+ bullets

2. **Three.js Learning Curve**
   - Mitigation: Keep Phase 1 simple, use basic geometries
   - Reference examples and documentation

3. **Browser Compatibility**
   - Mitigation: Test on target browsers early
   - Use WebGL fallback detection

### Design Risks

1. **Polarity Mechanic Too Complex**
   - Mitigation: Extensive tutorial, visual feedback
   - Playtesting with new players

2. **Difficulty Balance**
   - Mitigation: Adjustable difficulty curve via constants
   - Multiple playtesting iterations

---

## Success Metrics

- [x] Game runs at 60 FPS with 200+ bullets on screen
- [x] Polarity switching feels responsive (< 100ms perceived latency)
- [x] New players understand core mechanic within 60 seconds
- [x] Average play session > 5 minutes
- [x] Players can identify polarity at a glance
- [x] Chain combo system is visible and rewarding
- [x] Game is playable on standard web browsers
- [x] Zero critical bugs on release

---

## Next Steps

1. Begin Phase 0: Set up project structure
2. Install three.js and configure development environment
3. Create basic scene and render loop
4. Move to Phase 1: Start with player ship implementation
